<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>L9 Boss Tracker</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background: linear-gradient(-45deg, #000000, #0a0f14, #111827, #05070a);
    background-size: 300% 300%;
    animation: darkFlow 14s ease infinite;
    color:white;
}
body::before{
    content:"";
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: radial-gradient(circle at 20% 30%, rgba(0,120,255,0.08), transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(180,0,255,0.06), transparent 40%);
    pointer-events:none;
}


@keyframes darkFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}




header{
    padding:20px;
    font-size:24px;
    font-weight:bold;
    border-bottom:2px solid #1f2c3a;
    display:flex;
    align-items:center;
    justify-content:space-between;
    background:rgba(0,0,0,0.4);
    backdrop-filter:blur(6px);
    position:relative;
}

.header-left{
    flex:1;
}

.header-center{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
}

.header-right{
    flex:1;
    display:flex;
    justify-content:flex-end;
}


select{
    padding:10px 14px;
    background:linear-gradient(145deg,#0f1418,#1a1f25);
    color:#fff;
    border:1px solid #333;
    border-radius:10px;
    font-weight:bold;
    cursor:pointer;
    outline:none;
    transition:all 0.3s ease;
    box-shadow:0 0 12px rgba(0,0,0,0.6);
    appearance:none;
}

/* Glow when active */
select:hover{
    border-color:#ff9800;
    box-shadow:0 0 15px rgba(255,152,0,0.5);
}

select:focus{
    border-color:#4da6ff;
    box-shadow:0 0 18px rgba(77,166,255,0.6);
}

/* Style dropdown options (limited but works on most browsers) */
select option{
    background:#0f1418;
    color:white;
    padding:10px;
}

select{
    background-image:
        linear-gradient(145deg,#0f1418,#1a1f25),
        url("data:image/svg+xml;utf8,<svg fill='white' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
    background-repeat:no-repeat;
    background-position:right 10px center;
    background-size:16px;
    padding-right:35px;
}


header{
    padding:20px;
    font-size:24px;
    font-weight:bold;
    border-bottom:2px solid #1f2c3a;
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:rgba(0,0,0,0.4);
    backdrop-filter:blur(6px);
}

#todayGrid .card{
    border-left:4px solid #ff3b3b;
    animation: softGlow 4s ease-in-out infinite alternate;
}

@keyframes softGlow{
    0%{
        box-shadow: 0 0 6px rgba(255,59,59,0.15);
    }
    100%{
        box-shadow: 0 0 12px rgba(255,59,59,0.35);
    }
}




.section{ padding:20px; }

.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
    gap:20px;
}

.card{
    display:flex;
    background:#2a313a;
    border-radius:12px;
    overflow:hidden;
    transition:0.3s ease;
    border-left:4px solid #2196f3;
}

.card:hover{
    transform:translateY(-4px);
    background:#313b45;
}

.boss-img{
    width:110px;
    object-fit:cover;
}

.card-content{
    padding:15px;
    flex:1;
}

.badge{
    display:inline-block;
    font-size:10px;
    background:#7c3aed;
    padding:4px 8px;
    border-radius:6px;
    margin-bottom:6px;
}

.name{ font-weight:bold; }

.timer{ color:#4da6ff; margin-top:5px; }

.spawn{ font-size:12px; color:#aaa; }

input{
    margin-top:8px;
    padding:6px;
    background:#111;
    border:1px solid #444;
    color:white;
    border-radius:4px;
}

button{
    padding:6px 10px;
    margin-left:5px;
    background:#a8873a;
    border:none;
    border-radius:4px;
    cursor:pointer;
}


.warning{ color:#ff9800 !important; font-weight:bold; }

.ready{
    color:#ff3b3b !important;
    font-weight:bold;
    animation:pulseGlow 1.5s infinite;
}

@keyframes pulseGlow {
    0% { text-shadow:0 0 5px #ff3b3b; }
    50% { text-shadow:0 0 20px #ff3b3b; }
    100% { text-shadow:0 0 5px #ff3b3b; }
}

.admin-btn{
    margin-left:10px;
    padding:8px 14px;
    background:linear-gradient(145deg,#3b0a0a,#7a1c1c);
    color:white;
    border:1px solid #aa2b2b;
    border-radius:8px;
    font-weight:bold;
    cursor:pointer;
    transition:all 0.3s ease;
    box-shadow:0 0 8px rgba(255,0,0,0.3);
}

.admin-btn:hover{
    background:linear-gradient(145deg,#5c0f0f,#a32222);
    box-shadow:0 0 15px rgba(255,0,0,0.6);
    transform:translateY(-2px);
}

.admin-btn:active{
    transform:scale(0.95);
}

.admin-btn.active-admin{
    background:linear-gradient(145deg,#8b0000,#ff0000);
    box-shadow:0 0 20px rgba(255,0,0,0.8);
}

.site-title{
    font-size:26px;
    font-weight:800;
    background:linear-gradient(90deg,#ff9800,#ff3b3b,#ff9800);
    background-size:200% auto;
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    animation:titleGlow 4s linear infinite;
    text-shadow:0 0 10px rgba(255,80,0,0.4);
}

@keyframes titleGlow{
    0%{ background-position:0% center; }
    100%{ background-position:200% center; }
}


</style>
</head>

<body>

<header>
  <div class="header-left">
    <span class="site-title">ðŸ”¥ L9 Boss Tracker (AzteczX4é¾™)</span>
</div>

    <div class="header-center">
        <select id="timezoneSelect">
            <option value="8">Philippines (UTC+8)</option>
            <option value="7">Indonesia / Thailand (UTC+7)</option>
        </select>
    </div>

    <div class="header-right">
        <button class="admin-btn" onclick="adminLogin()">Admin</button>
    </div>
</header>

</header>

<div class="section">
<h2>ðŸ”¥ Today</h2>
<div class="grid" id="todayGrid"></div>

<h2>ðŸŒ™ Tomorrow</h2>
<div class="grid" id="tomorrowGrid"></div>

<h2>ðŸ“… Coming Soon</h2>
<div class="grid" id="soonGrid"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD0-Lmvx-dmxvQcb_b4T3U-D4sdadH9Y3g",
  authDomain: "l9-boss-tracker.firebaseapp.com",
  databaseURL: "https://l9-boss-tracker-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "l9-boss-tracker",
  storageBucket: "l9-boss-tracker.firebasestorage.app",
  messagingSenderId: "24208974708",
  appId: "1:24208974708:web:925e95b886b8ead9924221"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let cloudData = {};
let isTyping = false;
let isAdmin = false;


/* ===== TIMEZONE LOCAL STORAGE UPGRADE ===== */
let selectedOffset = 8;
const timezoneSelect = document.getElementById("timezoneSelect");

// Load saved timezone
const savedOffset = localStorage.getItem("timezoneOffset");
if(savedOffset){
    selectedOffset = parseInt(savedOffset);
    timezoneSelect.value = savedOffset;
}

// Save when changed
timezoneSelect.addEventListener("change", function(){
    selectedOffset = parseInt(this.value);
    localStorage.setItem("timezoneOffset", selectedOffset);
});
/* ========================================== */

function convertTimezone(date){
    const utc = date.getTime() + (date.getTimezoneOffset()*60000);
    return new Date(utc + selectedOffset*3600000);
}

function adminLogin(){
    document.querySelector(".admin-btn").classList.add("active-admin");
    const password = prompt("Enter Admin Password:");
    
    if(password === "1900"){   // change this later
        isAdmin = true;
        alert("Admin mode activated");
        applyAdminMode();
    } else {
        alert("Wrong password");
    }
}


/* ===== FULL BOSS LIST ===== */
const bosses = [

{ name:"Venatus", type:"interval", hours:10, image:"Pictures/Venatus.png"},
{ name:"Viorent", type:"interval", hours:10, image:"Pictures/Viorent.png"},
{ name:"Ego", type:"interval", hours:21, image:"Pictures/Ego.png"},
{ name:"Livera", type:"interval", hours:24, image:"Pictures/Livera.png"},
{ name:"Araneo", type:"interval", hours:24, image:"Pictures/Araneo.png"},
{ name:"Undomiel", type:"interval", hours:24, image:"Pictures/Undomiel.png"},
{ name:"Lady Dalia", type:"interval", hours:18, image:"Pictures/Lady Dalia.png"},
{ name:"General Aquleus", type:"interval", hours:29, image:"Pictures/General Aquleus.png"},
{ name:"Amentis", type:"interval", hours:29, image:"Pictures/Amentis.png"},
{ name:"Baron Braudmore", type:"interval", hours:32, image:"Pictures/Baron Braudmore.png"},
{ name:"Wannitas", type:"interval", hours:48, image:"Pictures/Wannitas.png"},
{ name:"Metus", type:"interval", hours:48, image:"Pictures/Metus.png"},
{ name:"Duplican", type:"interval", hours:48, image:"Pictures/Duplican.png"},
{ name:"Shuliar", type:"interval", hours:35, image:"Pictures/Shuliar.png"},
{ name:"Gareth", type:"interval", hours:32, image:"Pictures/Gareth.png"},
{ name:"Titore", type:"interval", hours:37, image:"Pictures/Titore.png"},
{ name:"Larba", type:"interval", hours:35, image:"Pictures/Larba.png"},
{ name:"Catena", type:"interval", hours:35, image:"Pictures/Catena.png"},
{ name:"Secreta", type:"interval", hours:62, image:"Pictures/Secreta.png"},
{ name:"Ordo", type:"interval", hours:62, image:"Pictures/Ordo.png"},
{ name:"Asta", type:"interval", hours:62, image:"Pictures/Asta.png"},
{ name:"Supore", type:"interval", hours:62, image:"Pictures/Supore.png"},

{ name:"Clemantis", type:"fixed",
schedule:[{day:1,time:"11:30"},{day:4,time:"19:00"}],
image:"Pictures/Clemantis.png"},

{ name:"Saphirus", type:"fixed",
schedule:[{day:0,time:"17:00"},{day:2,time:"11:30"}],
image:"Pictures/Saphirus.png"},

{ name:"Neutro", type:"fixed",
schedule:[{day:2,time:"19:00"},{day:4,time:"11:30"}],
image:"Pictures/Neutro.png"},

{ name:"Thymele", type:"fixed",
schedule:[{day:1,time:"19:00"},{day:3,time:"11:30"}],
image:"Pictures/Thymele.png"},

{ name:"Milavy", type:"fixed",
schedule:[{day:6,time:"15:00"}],
image:"Pictures/Milavy.png"},

{ name:"Ringor", type:"fixed",
schedule:[{day:6,time:"17:00"}],
image:"Pictures/Ringor.png"},

{ name:"Roderick", type:"fixed",
schedule:[{day:5,time:"19:00"}],
image:"Pictures/Roderick.png"},

{ name:"Auraq", type:"fixed",
schedule:[{day:5,time:"22:00"},{day:3,time:"21:00"}],
image:"Pictures/Auraq.png"},

{ name:"Chaiflock", type:"fixed",
schedule:[{day:6,time:"22:00"}],
image:"Pictures/Chaiflock.png"},

{ name:"Benji", type:"fixed",
schedule:[{day:0,time:"21:00"}],
image:"Pictures/Benji.png"},

{ name:"Tumier", type:"fixed",
schedule:[{day:0,time:"19:00"}],
image:"Pictures/Tumier.png"}

];
/* ===== END BOSS LIST ===== */

function getNextFixedSpawn(schedule){
    const now = new Date();
    let next = null;

    schedule.forEach(s=>{
        const target = new Date();
        const [h,m] = s.time.split(":");
        target.setHours(h,m,0,0);
        const dayDiff = (s.day - now.getDay() + 7) % 7;
        target.setDate(now.getDate() + dayDiff);
        if(target <= now) target.setDate(target.getDate()+7);
        if(!next || target < next) next = target;
    });

    return next;
}

function formatTime(ms){
    const total = Math.floor(ms/1000);
    const h = Math.floor(total/3600);
    const m = Math.floor((total%3600)/60);
    const s = total%60;
    return `${h}h ${m}m ${s}s`;
}

function isSameDay(d1,d2){
    return d1.getFullYear()===d2.getFullYear() &&
           d1.getMonth()===d2.getMonth() &&
           d1.getDate()===d2.getDate();
}

function isTomorrow(spawn, now){
    const tomorrow = new Date(now);
    tomorrow.setDate(now.getDate()+1);
    return isSameDay(spawn, tomorrow);
}

function createCard(boss){
    const card = document.createElement("div");
    card.className="card";
    card.dataset.spawn = Infinity;

    if(boss.type==="interval"){
        card.innerHTML=`
        <img class="boss-img" src="${boss.image}">
        <div class="card-content">
            <div class="badge">Interval</div>
            <div class="name">${boss.name} (${boss.hours}h)</div>
            <div class="timer">Not Set</div>
            <div class="spawn"></div>
         <div class="admin-controls">
    <input type="time"
           id="input-${boss.name}"
           onfocus="isTyping=true"
           onblur="isTyping=false">
    <button onclick="setDeath('${boss.name}',${boss.hours})">Set Death</button>
</div>
        </div>`;
    } else {
        card.innerHTML=`
        <img class="boss-img" src="${boss.image}">
        <div class="card-content">
            <div class="badge">Fixed</div>
            <div class="name">${boss.name}</div>
            <div class="timer">--</div>
            <div class="spawn"></div>
            <div class="fixed">Weekly Spawn</div>
        </div>`;
    }

    document.getElementById("soonGrid").appendChild(card);
}

function updateTimers(){
    const now = new Date();
    const cards = Array.from(document.querySelectorAll(".card"));

    cards.forEach(card=>{
        const bossName = card.querySelector(".name").innerText.split(" (")[0];
        const boss = bosses.find(b=>b.name===bossName);
        if(!boss) return;

        const timerEl = card.querySelector(".timer");
        const spawnEl = card.querySelector(".spawn");

        let spawn;

        if(boss.type==="interval"){
            const saved = cloudData[boss.name];
            if(!saved){
                timerEl.innerText="Not Set";
                card.dataset.spawn = Infinity;
                return;
            }
            spawn = new Date(saved);
        } else {
            spawn = getNextFixedSpawn(boss.schedule);
        }

        const remaining = spawn - now;
        card.dataset.spawn = spawn.getTime();

        if(remaining>0){
            timerEl.classList.remove("ready","warning");
            if(remaining<=3600000) timerEl.classList.add("warning");
            timerEl.innerText=formatTime(remaining);

            const converted = convertTimezone(spawn);
            spawnEl.innerText = "Spawn: " + converted.toLocaleString([], {
              year: "numeric",
              month: "numeric",
              day: "numeric",
              hour: "numeric",
              minute: "2-digit",
              hour12: true
});

        } else {
            timerEl.classList.remove("warning");
            timerEl.classList.add("ready");
            timerEl.innerText="ðŸ”¥ READY";
        }
    });
}

function sortBosses(){
    if(isTyping) return;

    const now = new Date();
    const today = document.getElementById("todayGrid");
    const tomorrow = document.getElementById("tomorrowGrid");
    const soon = document.getElementById("soonGrid");

    const cards = Array.from(document.querySelectorAll(".card"));

    // First separate by section logic
    cards.forEach(card=>{
        const spawnTime = Number(card.dataset.spawn);

        let targetSection;

        if(!spawnTime || spawnTime === Infinity){
            targetSection = soon;
        } else {
            const spawnDate = new Date(spawnTime);

            if(isSameDay(spawnDate, now)){
                targetSection = today;
            }
            else if(isTomorrow(spawnDate, now)){
                targetSection = tomorrow;
            }
            else{
                targetSection = soon;
            }
        }

        if(card.parentElement !== targetSection){
            targetSection.appendChild(card);
        }
    });

    // ðŸ”¥ Now fix Coming Soon order ONLY
    const soonCards = Array.from(soon.querySelectorAll(".card"));

    soonCards.sort((a,b)=>{
        const spawnA = Number(a.dataset.spawn);
        const spawnB = Number(b.dataset.spawn);

        const hasTimerA = spawnA && spawnA !== Infinity;
        const hasTimerB = spawnB && spawnB !== Infinity;

        // Timed bosses above Not Set
        if(hasTimerA && !hasTimerB) return -1;
        if(!hasTimerA && hasTimerB) return 1;

        // Both timed â†’ sort lowest first
        if(hasTimerA && hasTimerB){
            return spawnA - spawnB;
        }

        return 0;
    });

    // Re-append in correct order (no innerHTML wipe)
    soonCards.forEach(card=>{
        soon.appendChild(card);
    });
}


function setDeath(name,hours){
    const input = document.getElementById("input-"+name).value;
    if(!input) return;

    const [h,m] = input.split(":");
    const death = new Date();
    death.setHours(h,m,0,0);

    const spawn = death.getTime() + hours*3600000;
    db.ref("bossTimers/"+name).set(spawn);
}

db.ref("bossTimers").on("value",snap=>{
    cloudData = snap.val() || {};
});

bosses.forEach(createCard);
applyAdminMode();


function applyAdminMode(){
    const controls = document.querySelectorAll(".admin-controls");
    
    controls.forEach(control=>{
        control.style.display = isAdmin ? "block" : "none";
    });
}

setInterval(updateTimers,1000);
setInterval(sortBosses,3000);


</script>
</body>
</html>
